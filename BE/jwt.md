# JWT

## 목차

- [JWT](#jwt)
  - [목차](#목차)
  - [JWT란?](#jwt란)
  - [JWT VS Session](#jwt-vs-session)
  - [JWT 탈취 예방](#jwt-탈취-예방)

## JWT란?

JWT란 JSON Web Token의 약자로, JSON 객체를 사용하여 웹 통신 간에 정보를 안전하게 전달하기 위한 토큰을 의미한다.
주로 로그인을 할 때 사용되며, 로그인을 하면 서버에서 JWT를 발급해준다.
이후 클라이언트는 서버에 요청할 때마다 JWT를 Authorization 헤더에 담아서 보내면 서버는 JWT를 검증하여 요청을 처리한다.

JWT는 토큰을 생성할 때 헤더, 페이로드, 서명으로 구성된다.
헤더는 토큰의 타입과 해싱 알고리즘을 정의한다. 주로 HS256을 사용한다.
페이로드는 토큰에 담을 정보를 담는다. 주로 사용자의 id 등을 담는다.
서명은 헤더와 페이로드를 합쳐서 비밀키로 해싱한 것이다. 서명을 통해 토큰이 변조되지 않았는지 검증할 수 있다.

## JWT VS Session

JWT는 주로 세션과 비교된다. HTTP는 매 통신을 독립적인 트랜젝션으로 취급하기 때문에 상태가 이어지지 않는다. 따라서 서버와 클라이언트의 연속성을 유지하기 위해 세션 기법이 만들어졌다. 세션은 서버에 사용자 정보를 저장하고, 클라이언트는 세션 아이디를 쿠키에 저장하여 사용한다. 하지만 세션은 서버에 사용자 정보를 저장하기 때문에 서버의 자원을 사용하게 되고, 서버에 부하가 걸린다. 과부하를 막기 위해 서버를 나누면 세션이 끊기게 되므로 추가 자원이 필요하다. 이러한 단점을 보완하기 위해 JWT가 등장하게 되었다.

JWT는 서버에 사용자 정보를 저장하지 않고, 토큰을 발급해준다. 토큰만 가지고 있으면 어느 서버에서든 연속적으로 사용이 가능하다. 또한 서버에 사용자 정보를 저장하지 않기 때문에 서버의 자원을 덜 사용한다. 하지만 또한 매번 세션 ID 와 요청만 보내면 되는 세션에 비해 토큰을 매번 주고 받으며 검증해야 하기 때문에 안정성과 성능이 떨어진다.

## JWT 탈취 예방

JWT는 토큰을 생성할 때 헤더, 페이로드, 서명으로 구성되며, 이중 검증에 이용되는 것은 서명이다.
서명은 헤더와 페이로드를 합쳐서 비밀키로 해싱한 것으로, 서명을 통해 토큰이 변조되지 않았는지 검증할 수 있다.

하지만 토큰 자체를 탈취당할 가능성이 있기 때문에 Refresh Token Rotation 기법을 사용하기도 한다.
RTR 기법은 실제 인증에 사용하는 Access 토큰과 Refresh 토큰을 분리하여 사용하는 기법이다. Access 토큰은 비교적 짧은 시간으로 설정하고, Refresh 토큰은 비교적 긴 시간으로 설정한다.
평소 인증 시에는 Access 토큰을 사용하다, Access 토큰이 만료되면 Refresh 토큰을 사용하여 인증해 새로운 Access 토큰과 Refresh 토큰을 발급받는다.
추후 이미 만료된 Refresh 토큰을 사용하여 새로운 Access 토큰을 발급 받으려고 하면, 해당 Refresh 토큰을 탈취당한 것으로 간주한다. 또한 해당 Refresh 토큰을 통해 발급 받은 모든 토큰을 탈취당한 것으로 간주하여 관련된 모든 토큰을 차단한다.
